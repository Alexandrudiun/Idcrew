import{r as P,j as F}from"./react-DvsdDthM.js";import{L as ce,T as Ye,R as Ke,U as Je,a as Qe,O as Ze,P as et,S as Se,b as le,N as tt,A as nt,B as rt,M as ot,C as it,W as st,c as at,d as ct,e as lt,V as ft,f as K,g as ut,h as dt,i as pt,j as vt,k as mt}from"./three-CYHPcAjH.js";import{u as ht}from"./react-use-measure-BmMy3EoY.js";import{F as gt,u as wt}from"./its-fine-z8kMFGEH.js";import{R as yt,c as U}from"./react-reconciler-C16tENYH.js";import{s as Pe}from"./scheduler-CzFDRTuY.js";import"./react-dom-C30jrkNp.js";import{G as be,D as _t,M as fe,O as bt}from"./three-stdlib-v__waRog.js";import{_ as Ct}from"./@babel-CF3RwP-h.js";import{c as Et}from"./zustand-D0D0Oln6.js";import{s as St,p as Pt,c as Mt}from"./suspend-react-BKIKQNXN.js";const Ce={},xt=e=>void Object.assign(Ce,e);function Ot(e,t){function o(n,{args:r=[],attach:a,...p},m){let y=`${n[0].toUpperCase()}${n.slice(1)}`,d;if(n==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=p.object;d=G(s,{type:n,root:m,attach:a,primitive:!0})}else{const s=Ce[y];if(!s)throw new Error(`R3F: ${y} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");d=G(new s(...r),{type:n,root:m,attach:a,memoizedProps:{args:r}})}return d.__r3f.attach===void 0&&(d instanceof rt?d.__r3f.attach="geometry":d instanceof ot&&(d.__r3f.attach="material")),y!=="inject"&&pe(d,p),d}function i(n,r){let a=!1;if(r){var p,m;(p=r.__r3f)!=null&&p.attach?de(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),a=!0),a||(m=n.__r3f)==null||m.objects.push(r),r.__r3f||G(r,{}),r.__r3f.parent=n,_e(r),q(r)}}function l(n,r,a){let p=!1;if(r){var m,y;if((m=r.__r3f)!=null&&m.attach)de(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:r});const d=n.children.filter(f=>f!==r),s=d.indexOf(a);n.children=[...d.slice(0,s),r,...d.slice(s)],p=!0}p||(y=n.__r3f)==null||y.objects.push(r),r.__r3f||G(r,{}),r.__r3f.parent=n,_e(r),q(r)}}function u(n,r,a=!1){n&&[...n].forEach(p=>g(r,p,a))}function g(n,r,a){if(r){var p,m,y;if(r.__r3f&&(r.__r3f.parent=null),(p=n.__r3f)!=null&&p.objects&&(n.__r3f.objects=n.__r3f.objects.filter(E=>E!==r)),(m=r.__r3f)!=null&&m.attach)je(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var d;n.remove(r),(d=r.__r3f)!=null&&d.root&&zt(ie(r),r)}const f=(y=r.__r3f)==null?void 0:y.primitive,w=!f&&(a===void 0?r.dispose!==null:a);if(!f){var s;u((s=r.__r3f)==null?void 0:s.objects,r,w),u(r.children,r,w)}if(delete r.__r3f,w&&r.dispose&&r.type!=="Scene"){const E=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Pe.unstable_scheduleCallback(Pe.unstable_IdlePriority,E):E()}q(n)}}function h(n,r,a,p){var m;const y=(m=n.__r3f)==null?void 0:m.parent;if(!y)return;const d=o(r,a,n.__r3f.root);if(n.children){for(const s of n.children)s.__r3f&&i(d,s);n.children=n.children.filter(s=>!s.__r3f)}n.__r3f.objects.forEach(s=>i(d,s)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||g(y,n),d.parent&&(d.__r3f.autoRemovedBeforeAppend=!0),i(y,d),d.raycast&&d.__r3f.eventCount&&ie(d).getState().internal.interaction.push(d),[p,p.alternate].forEach(s=>{s!==null&&(s.stateNode=d,s.ref&&(typeof s.ref=="function"?s.ref(d):s.ref.current=d))})}const c=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:yt({createInstance:o,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:l,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const a=n.getState().scene;a.__r3f&&(a.__r3f.root=n,i(a,r))},removeChildFromContainer:(n,r)=>{r&&g(n.getState().scene,r)},insertInContainerBefore:(n,r,a)=>{if(!r||!a)return;const p=n.getState().scene;p.__r3f&&l(p,r,a)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,a,p){var m;if(((m=n==null?void 0:n.__r3f)!=null?m:{}).primitive&&p.object&&p.object!==n)return[!0];{const{args:d=[],children:s,...f}=p,{args:w=[],children:E,...C}=a;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((x,R)=>x!==w[R]))return[!0];const b=He(n,f,C,!0);return b.changes.length?[!1,b]:null}},commitUpdate(n,[r,a],p,m,y,d){r?h(n,p,y,d):pe(n,a)},commitMount(n,r,a,p){var m;const y=(m=n.__r3f)!=null?m:{};n.raycast&&y.handlers&&y.eventCount&&ie(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>G(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:a,parent:p}=(r=n.__r3f)!=null?r:{};a&&p&&je(p,n,a),n.isObject3D&&(n.visible=!1),q(n)},unhideInstance(n,r){var a;const{attach:p,parent:m}=(a=n.__r3f)!=null?a:{};p&&m&&de(m,n,p),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),q(n)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():U.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&M.fun(performance.now)?performance.now:M.fun(Date.now)?Date.now:()=>0,scheduleTimeout:M.fun(setTimeout)?setTimeout:void 0,cancelTimeout:M.fun(clearTimeout)?clearTimeout:void 0}),applyProps:pe}}var Me,xe;const ue=e=>"colorSpace"in e||"outputColorSpace"in e,ke=()=>{var e;return(e=Ce.ColorManagement)!=null?e:null},De=e=>e&&e.isOrthographicCamera,Rt=e=>e&&e.hasOwnProperty("current"),J=typeof window<"u"&&((Me=window.document)!=null&&Me.createElement||((xe=window.navigator)==null?void 0:xe.product)==="ReactNative")?P.useLayoutEffect:P.useEffect;function Fe(e){const t=P.useRef(e);return J(()=>void(t.current=e),[e]),t}function jt({set:e}){return J(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ze extends P.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ze.getDerivedStateFromError=()=>({error:!0});const Ie="__default",Oe=new Map,Tt=e=>e&&!!e.memoized&&!!e.changes;function Be(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const X=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function ie(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const M={obj:e=>e===Object(e)&&!M.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:l=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(M.str(e)||M.num(e)||M.boo(e))return e===t;const u=M.obj(e);if(u&&i==="reference")return e===t;const g=M.arr(e);if(g&&o==="reference")return e===t;if((g||u)&&e===t)return!0;let h;for(h in e)if(!(h in t))return!1;if(u&&o==="shallow"&&i==="shallow"){for(h in l?t:e)if(!M.equ(e[h],t[h],{strict:l,objects:"reference"}))return!1}else for(h in l?t:e)if(e[h]!==t[h])return!1;if(M.und(h)){if(g&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function At(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function Lt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function G(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function ye(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),l=i.pop();return o=i.reduce((u,g)=>u[g],e),{target:o,key:l}}else return{target:o,key:t}}const Re=/-\d+$/;function de(e,t,o){if(M.str(o)){if(Re.test(o)){const u=o.replace(Re,""),{target:g,key:h}=ye(e,u);Array.isArray(g[h])||(g[h]=[])}const{target:i,key:l}=ye(e,o);t.__r3f.previousAttach=i[l],i[l]=t}else t.__r3f.previousAttach=o(e,t)}function je(e,t,o){var i,l;if(M.str(o)){const{target:u,key:g}=ye(e,o),h=t.__r3f.previousAttach;h===void 0?delete u[g]:u[g]=h}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(l=t.__r3f)==null||delete l.previousAttach}function He(e,{children:t,key:o,ref:i,...l},{children:u,key:g,ref:h,...c}={},v=!1){const n=e.__r3f,r=Object.entries(l),a=[];if(v){const m=Object.keys(c);for(let y=0;y<m.length;y++)l.hasOwnProperty(m[y])||r.unshift([m[y],Ie+"remove"])}r.forEach(([m,y])=>{var d;if((d=e.__r3f)!=null&&d.primitive&&m==="object"||M.equ(y,c[m]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(m))return a.push([m,y,!0,[]]);let s=[];m.includes("-")&&(s=m.split("-")),a.push([m,y,!1,s]);for(const f in l){const w=l[f];f.startsWith(`${m}-`)&&a.push([f,w,!1,f.split("-")])}});const p={...l};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(p.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(p.attach=n.memoizedProps.attach),{memoized:p,changes:a}}const kt=typeof process<"u"&&!1;function pe(e,t){var o;const i=e.__r3f,l=i==null?void 0:i.root,u=l==null||l.getState==null?void 0:l.getState(),{memoized:g,changes:h}=Tt(t)?t:He(e,t),c=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=g);for(let n=0;n<h.length;n++){let[r,a,p,m]=h[n];if(ue(e)){const f="srgb",w="srgb-linear";r==="encoding"?(r="colorSpace",a=a===3001?f:w):r==="outputEncoding"&&(r="outputColorSpace",a=a===3001?f:w)}let y=e,d=y[r];if(m.length&&(d=m.reduce((s,f)=>s[f],e),!(d&&d.set))){const[s,...f]=m.reverse();y=f.reverse().reduce((w,E)=>w[E],e),r=s}if(a===Ie+"remove")if(y.constructor){let s=Oe.get(y.constructor);s||(s=new y.constructor,Oe.set(y.constructor,s)),a=s[r]}else a=0;if(p&&i)a?i.handlers[r]=a:delete i.handlers[r],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof ce)){if(Array.isArray(a))d.fromArray?d.fromArray(a):d.set(...a);else if(d.copy&&a&&a.constructor&&(kt?d.constructor.name===a.constructor.name:d.constructor===a.constructor))d.copy(a);else if(a!==void 0){const s=d instanceof it;!s&&d.setScalar?d.setScalar(a):d instanceof ce&&a instanceof ce?d.mask=a.mask:d.set(a),!ke()&&u&&!u.linear&&s&&d.convertSRGBToLinear()}}else if(y[r]=a,y[r]instanceof Ye&&y[r].format===Ke&&y[r].type===Je&&u){const s=y[r];ue(s)&&ue(u.gl)?s.colorSpace=u.gl.outputColorSpace:s.encoding=u.gl.outputEncoding}q(e)}if(i&&i.parent&&e.raycast&&c!==i.eventCount){const n=ie(e).getState().internal,r=n.interaction.indexOf(e);r>-1&&n.interaction.splice(r,1),i.eventCount&&n.interaction.push(e)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(o=e.__r3f)!=null&&o.parent&&_e(e),e}function q(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function _e(e){e.onUpdate==null||e.onUpdate(e)}function Dt(e,t){e.manual||(De(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ne(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ft(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return U.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return U.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return U.ContinuousEventPriority;default:return U.DefaultEventPriority}}function Ne(e,t,o,i){const l=o.get(t);l&&(o.delete(t),o.size===0&&(e.delete(i),l.target.releasePointerCapture(i)))}function zt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,l)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(l)}),o.capturedMap.forEach((i,l)=>{Ne(o.capturedMap,t,i,l)})}function It(e){function t(c){const{internal:v}=e.getState(),n=c.offsetX-v.initialClick[0],r=c.offsetY-v.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(c){return c.filter(v=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=v.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(c,v){const n=e.getState(),r=new Set,a=[],p=v?v(n.internal.interaction):n.internal.interaction;for(let s=0;s<p.length;s++){const f=X(p[s]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(c,n);function m(s){const f=X(s);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var w;f.events.compute==null||f.events.compute(c,f,(w=f.previousRoot)==null?void 0:w.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(s,!0):[]}let y=p.flatMap(m).sort((s,f)=>{const w=X(s.object),E=X(f.object);return!w||!E?s.distance-f.distance:E.events.priority-w.events.priority||s.distance-f.distance}).filter(s=>{const f=ne(s);return r.has(f)?!1:(r.add(f),!0)});n.events.filter&&(y=n.events.filter(y,n));for(const s of y){let f=s.object;for(;f;){var d;(d=f.__r3f)!=null&&d.eventCount&&a.push({...s,eventObject:f}),f=f.parent}}if("pointerId"in c&&n.internal.capturedMap.has(c.pointerId))for(let s of n.internal.capturedMap.get(c.pointerId).values())r.has(ne(s.intersection))||a.push(s.intersection);return a}function l(c,v,n,r){const a=e.getState();if(c.length){const p={stopped:!1};for(const m of c){const y=X(m.object)||a,{raycaster:d,pointer:s,camera:f,internal:w}=y,E=new K(s.x,s.y,0).unproject(f),C=j=>{var _,O;return(_=(O=w.capturedMap.get(j))==null?void 0:O.has(m.eventObject))!=null?_:!1},b=j=>{const _={intersection:m,target:v.target};w.capturedMap.has(j)?w.capturedMap.get(j).set(m.eventObject,_):w.capturedMap.set(j,new Map([[m.eventObject,_]])),v.target.setPointerCapture(j)},x=j=>{const _=w.capturedMap.get(j);_&&Ne(w.capturedMap,m.eventObject,_,j)};let R={};for(let j in v){let _=v[j];typeof _!="function"&&(R[j]=_)}let S={...m,...R,pointer:s,intersections:c,stopped:p.stopped,delta:n,unprojectedPoint:E,ray:d.ray,camera:f,stopPropagation(){const j="pointerId"in v&&w.capturedMap.get(v.pointerId);if((!j||j.has(m.eventObject))&&(S.stopped=p.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(_=>_.eventObject===m.eventObject))){const _=c.slice(0,c.indexOf(m));u([..._,m])}},target:{hasPointerCapture:C,setPointerCapture:b,releasePointerCapture:x},currentTarget:{hasPointerCapture:C,setPointerCapture:b,releasePointerCapture:x},nativeEvent:v};if(r(S),p.stopped===!0)break}}return c}function u(c){const{internal:v}=e.getState();for(const n of v.hovered.values())if(!c.length||!c.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const a=n.eventObject.__r3f,p=a==null?void 0:a.handlers;if(v.hovered.delete(ne(n)),a!=null&&a.eventCount){const m={...n,intersections:c};p.onPointerOut==null||p.onPointerOut(m),p.onPointerLeave==null||p.onPointerLeave(m)}}}function g(c,v){for(let n=0;n<v.length;n++){const r=v[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(c)}}function h(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return v=>{const{internal:n}=e.getState();"pointerId"in v&&n.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(v.pointerId)&&(n.capturedMap.delete(v.pointerId),u([]))})}}return function(n){const{onPointerMissed:r,internal:a}=e.getState();a.lastEvent.current=n;const p=c==="onPointerMove",m=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",d=i(n,p?o:void 0),s=m?t(n):0;c==="onPointerDown"&&(a.initialClick=[n.offsetX,n.offsetY],a.initialHits=d.map(w=>w.eventObject)),m&&!d.length&&s<=2&&(g(n,a.interaction),r&&r(n)),p&&u(d);function f(w){const E=w.eventObject,C=E.__r3f,b=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(p){if(b.onPointerOver||b.onPointerEnter||b.onPointerOut||b.onPointerLeave){const x=ne(w),R=a.hovered.get(x);R?R.stopped&&w.stopPropagation():(a.hovered.set(x,w),b.onPointerOver==null||b.onPointerOver(w),b.onPointerEnter==null||b.onPointerEnter(w))}b.onPointerMove==null||b.onPointerMove(w)}else{const x=b[c];x?(!m||a.initialHits.includes(E))&&(g(n,a.interaction.filter(R=>!a.initialHits.includes(R))),x(w)):m&&a.initialHits.includes(E)&&g(n,a.interaction.filter(R=>!a.initialHits.includes(R)))}}l(d,n,s,f)}}return{handlePointer:h}}const Ge=e=>!!(e!=null&&e.render),qe=P.createContext(null),Bt=(e,t)=>{const o=Et((h,c)=>{const v=new K,n=new K,r=new K;function a(s=c().camera,f=n,w=c().size){const{width:E,height:C,top:b,left:x}=w,R=E/C;f instanceof K?r.copy(f):r.set(...f);const S=s.getWorldPosition(v).distanceTo(r);if(De(s))return{width:E/s.zoom,height:C/s.zoom,top:b,left:x,factor:1,distance:S,aspect:R};{const j=s.fov*Math.PI/180,_=2*Math.tan(j/2)*S,O=_*(E/C);return{width:O,height:_,top:b,left:x,factor:E/O,distance:S,aspect:R}}}let p;const m=s=>h(f=>({performance:{...f.performance,current:s}})),y=new ut;return{set:h,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(c(),s),advance:(s,f)=>t(s,f,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new dt,pointer:y,mouse:y,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=c();p&&clearTimeout(p),s.performance.current!==s.performance.min&&m(s.performance.min),p=setTimeout(()=>m(c().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:s=>h(f=>({...f,events:{...f.events,...s}})),setSize:(s,f,w,E,C)=>{const b=c().camera,x={width:s,height:f,top:E||0,left:C||0,updateStyle:w};h(R=>({size:x,viewport:{...R.viewport,...a(b,n,x)}}))},setDpr:s=>h(f=>{const w=Be(s);return{viewport:{...f.viewport,dpr:w,initialDpr:f.viewport.initialDpr||w}}}),setFrameloop:(s="always")=>{const f=c().clock;f.stop(),f.elapsedTime=0,s!=="never"&&(f.start(),f.elapsedTime=0),h(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:P.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,f,w)=>{const E=c().internal;return E.priority=E.priority+(f>0?1:0),E.subscribers.push({ref:s,priority:f,store:w}),E.subscribers=E.subscribers.sort((C,b)=>C.priority-b.priority),()=>{const C=c().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(f>0?1:0),C.subscribers=C.subscribers.filter(b=>b.ref!==s))}}}}}),i=o.getState();let l=i.size,u=i.viewport.dpr,g=i.camera;return o.subscribe(()=>{const{camera:h,size:c,viewport:v,gl:n,set:r}=o.getState();if(c.width!==l.width||c.height!==l.height||v.dpr!==u){var a;l=c,u=v.dpr,Dt(h,c),n.setPixelRatio(v.dpr);const p=(a=c.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(c.width,c.height,p)}h!==g&&(g=h,r(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(h)}})))}),o.subscribe(h=>e(h)),o};let re,Ht=new Set,Nt=new Set,Gt=new Set;function ve(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function Y(e,t){switch(e){case"before":return ve(Ht,t);case"after":return ve(Nt,t);case"tail":return ve(Gt,t)}}let me,he;function ge(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),me=t.internal.subscribers,re=0;re<me.length;re++)he=me[re],he.ref.current(he.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function qt(e){let t=!1,o=!1,i,l,u;function g(v){l=requestAnimationFrame(g),t=!0,i=0,Y("before",v),o=!0;for(const r of e.values()){var n;u=r.store.getState(),u.internal.active&&(u.frameloop==="always"||u.internal.frames>0)&&!((n=u.gl.xr)!=null&&n.isPresenting)&&(i+=ge(v,u))}if(o=!1,Y("after",v),i===0)return Y("tail",v),t=!1,cancelAnimationFrame(l)}function h(v,n=1){var r;if(!v)return e.forEach(a=>h(a.store.getState(),n));(r=v.gl.xr)!=null&&r.isPresenting||!v.internal.active||v.frameloop==="never"||(n>1?v.internal.frames=Math.min(60,v.internal.frames+n):o?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(g)))}function c(v,n=!0,r,a){if(n&&Y("before",v),r)ge(v,r,a);else for(const p of e.values())ge(v,p.store.getState());n&&Y("after",v)}return{loop:g,invalidate:h,advance:c}}function Ue(){const e=P.useContext(qe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function D(e=o=>o,t){return Ue()(e,t)}function Ut(e,t=0){const o=Ue(),i=o.getState().internal.subscribe,l=Fe(e);return J(()=>i(l,t,o),[t,i,o]),null}const Te=new WeakMap;function We(e,t){return function(o,...i){let l=Te.get(o);return l||(l=new o,Te.set(o,l)),e&&e(l),Promise.all(i.map(u=>new Promise((g,h)=>l.load(u,c=>{c.scene&&Object.assign(c,At(c.scene)),g(c)},t,c=>h(new Error(`Could not load ${u}: ${c==null?void 0:c.message}`))))))}}function Q(e,t,o,i){const l=Array.isArray(t)?t:[t],u=St(We(o,i),[e,...l],{equal:M.equ});return Array.isArray(t)?u:u[0]}Q.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return Pt(We(o),[e,...i])};Q.clear=function(e,t){const o=Array.isArray(t)?t:[t];return Mt([e,...o])};const W=new Map,{invalidate:Ae,advance:Le}=qt(W),{reconciler:se,applyProps:H}=Ot(W,Ft),N={objects:"shallow",strict:!1},Wt=(e,t)=>{const o=typeof e=="function"?e(t):e;return Ge(o)?o:new st({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Vt(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:l,top:u,left:g,updateStyle:h=o}=t;return{width:i,height:l,top:u,left:g,updateStyle:h}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:l,top:u,left:g}=e.parentElement.getBoundingClientRect();return{width:i,height:l,top:u,left:g,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function $t(e){const t=W.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const l=typeof reportError=="function"?reportError:console.error,u=i||Bt(Ae,Le),g=o||se.createContainer(u,U.ConcurrentRoot,null,!1,null,"",l,null);t||W.set(e,{fiber:g,store:u});let h,c=!1,v;return{configure(n={}){let{gl:r,size:a,scene:p,events:m,onCreated:y,shadows:d=!1,linear:s=!1,flat:f=!1,legacy:w=!1,orthographic:E=!1,frameloop:C="always",dpr:b=[1,2],performance:x,raycaster:R,camera:S,onPointerMissed:j}=n,_=u.getState(),O=_.gl;_.gl||_.set({gl:O=Wt(r,e)});let k=_.raycaster;k||_.set({raycaster:k=new Qe});const{params:V,...Z}=R||{};if(M.equ(Z,k,N)||H(k,{...Z}),M.equ(V,k.params,N)||H(k,{params:{...k.params,...V}}),!_.camera||_.camera===v&&!M.equ(v,S,N)){v=S;const L=S instanceof at,T=L?S:E?new Ze(0,0,0,0,.1,1e3):new et(75,0,.1,1e3);L||(T.position.z=5,S&&(H(T,S),("aspect"in S||"left"in S||"right"in S||"bottom"in S||"top"in S)&&(T.manual=!0,T.updateProjectionMatrix())),!_.camera&&!(S!=null&&S.rotation)&&T.lookAt(0,0,0)),_.set({camera:T}),k.camera=T}if(!_.scene){let L;p instanceof Se?L=p:(L=new Se,p&&H(L,p)),_.set({scene:G(L)})}if(!_.xr){var $;const L=(A,ae)=>{const te=u.getState();te.frameloop!=="never"&&Le(A,!0,te,ae)},T=()=>{const A=u.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?L:null),A.gl.xr.isPresenting||Ae(A)},B={connect(){const A=u.getState().gl;A.xr.addEventListener("sessionstart",T),A.xr.addEventListener("sessionend",T)},disconnect(){const A=u.getState().gl;A.xr.removeEventListener("sessionstart",T),A.xr.removeEventListener("sessionend",T)}};typeof(($=O.xr)==null?void 0:$.addEventListener)=="function"&&B.connect(),_.set({xr:B})}if(O.shadowMap){const L=O.shadowMap.enabled,T=O.shadowMap.type;if(O.shadowMap.enabled=!!d,M.boo(d))O.shadowMap.type=le;else if(M.str(d)){var ee;const B={basic:ct,percentage:lt,soft:le,variance:ft};O.shadowMap.type=(ee=B[d])!=null?ee:le}else M.obj(d)&&Object.assign(O.shadowMap,d);(L!==O.shadowMap.enabled||T!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const z=ke();z&&("enabled"in z?z.enabled=!w:"legacyMode"in z&&(z.legacyMode=w)),c||H(O,{outputEncoding:s?3e3:3001,toneMapping:f?tt:nt}),_.legacy!==w&&_.set(()=>({legacy:w})),_.linear!==s&&_.set(()=>({linear:s})),_.flat!==f&&_.set(()=>({flat:f})),r&&!M.fun(r)&&!Ge(r)&&!M.equ(r,O,N)&&H(O,r),m&&!_.events.handlers&&_.set({events:m(u)});const I=Vt(e,a);return M.equ(I,_.size,N)||_.setSize(I.width,I.height,I.updateStyle,I.top,I.left),b&&_.viewport.dpr!==Be(b)&&_.setDpr(b),_.frameloop!==C&&_.setFrameloop(C),_.onPointerMissed||_.set({onPointerMissed:j}),x&&!M.equ(x,_.performance,N)&&_.set(L=>({performance:{...L.performance,...x}})),h=y,c=!0,this},render(n){return c||this.configure(),se.updateContainer(F.jsx(Xt,{store:u,children:n,onCreated:h,rootElement:e}),g,null,()=>{}),u},unmount(){Ve(e)}}}function Xt({store:e,children:t,onCreated:o,rootElement:i}){return J(()=>{const l=e.getState();l.set(u=>({internal:{...u.internal,active:!0}})),o&&o(l),e.getState().events.connected||l.events.connect==null||l.events.connect(i)},[]),F.jsx(qe.Provider,{value:e,children:t})}function Ve(e,t){const o=W.get(e),i=o==null?void 0:o.fiber;if(i){const l=o==null?void 0:o.store.getState();l&&(l.internal.active=!1),se.updateContainer(null,i,null,()=>{l&&setTimeout(()=>{try{var u,g,h,c;l.events.disconnect==null||l.events.disconnect(),(u=l.gl)==null||(g=u.renderLists)==null||g.dispose==null||g.dispose(),(h=l.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(c=l.gl)!=null&&c.xr&&l.xr.disconnect(),Lt(l),W.delete(e)}catch{}},500)})}}se.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:P.version});const we={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Yt(e){const{handlePointer:t}=It(e);return{priority:1,enabled:!0,compute(o,i,l){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(we).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:l}=e.getState();(o=l.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(l.lastEvent.current)},connect:o=>{var i;const{set:l,events:u}=e.getState();u.disconnect==null||u.disconnect(),l(g=>({events:{...g.events,connected:o}})),Object.entries((i=u.handlers)!=null?i:[]).forEach(([g,h])=>{const[c,v]=we[g];o.addEventListener(c,h,{passive:v})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var l;Object.entries((l=i.handlers)!=null?l:[]).forEach(([u,g])=>{if(i&&i.connected instanceof HTMLElement){const[h]=we[u];i.connected.removeEventListener(h,g)}}),o(u=>({events:{...u.events,connected:void 0}}))}}}}const Kt=P.forwardRef(function({children:t,fallback:o,resize:i,style:l,gl:u,events:g=Yt,eventSource:h,eventPrefix:c,shadows:v,linear:n,flat:r,legacy:a,orthographic:p,frameloop:m,dpr:y,performance:d,raycaster:s,camera:f,scene:w,onPointerMissed:E,onCreated:C,...b},x){P.useMemo(()=>xt(pt),[]);const R=wt(),[S,j]=ht({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=P.useRef(null),O=P.useRef(null);P.useImperativeHandle(x,()=>_.current);const k=Fe(E),[V,Z]=P.useState(!1),[$,ee]=P.useState(!1);if(V)throw V;if($)throw $;const z=P.useRef(null);J(()=>{const L=_.current;j.width>0&&j.height>0&&L&&(z.current||(z.current=$t(L)),z.current.configure({gl:u,events:g,shadows:v,linear:n,flat:r,legacy:a,orthographic:p,frameloop:m,dpr:y,performance:d,raycaster:s,camera:f,scene:w,size:j,onPointerMissed:(...T)=>k.current==null?void 0:k.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(h?Rt(h)?h.current:h:O.current),c&&T.setEvents({compute:(B,A)=>{const ae=B[c+"X"],te=B[c+"Y"];A.pointer.set(ae/A.size.width*2-1,-(te/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,A.camera)}}),C==null||C(T)}}),z.current.render(F.jsx(R,{children:F.jsx(ze,{set:ee,children:F.jsx(P.Suspense,{fallback:F.jsx(jt,{set:Z}),children:t})})})))}),P.useEffect(()=>{const L=_.current;if(L)return()=>Ve(L)},[]);const I=h?"none":"auto";return F.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:I,...l},...b,children:F.jsx("div",{ref:S,style:{width:"100%",height:"100%"},children:F.jsx("canvas",{ref:_,style:{display:"block"},children:o})})})}),ln=P.forwardRef(function(t,o){return F.jsx(gt,{children:F.jsx(Kt,{...t,ref:o})})});let oe=null,$e="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Xe(e,t,o){return i=>{o&&o(i),e&&(oe||(oe=new _t),oe.setDecoderPath(typeof e=="string"?e:$e),i.setDRACOLoader(oe)),t&&i.setMeshoptDecoder(typeof fe=="function"?fe():fe)}}function Ee(e,t=!0,o=!0,i){return Q(be,e,Xe(t,o,i))}Ee.preload=(e,t=!0,o=!0,i)=>Q.preload(be,e,Xe(t,o,i));Ee.clear=e=>Q.clear(be,e);Ee.setDecoderPath=e=>{$e=e};const fn=P.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:l=!0,keyEvents:u=!1,onChange:g,onStart:h,onEnd:c,...v},n)=>{const r=D(b=>b.invalidate),a=D(b=>b.camera),p=D(b=>b.gl),m=D(b=>b.events),y=D(b=>b.setEvents),d=D(b=>b.set),s=D(b=>b.get),f=D(b=>b.performance),w=t||a,E=i||m.connected||p.domElement,C=P.useMemo(()=>new bt(w),[w]);return Ut(()=>{C.enabled&&C.update()},-1),P.useEffect(()=>(u&&C.connect(u===!0?E:u),C.connect(E),()=>void C.dispose()),[u,E,o,C,r]),P.useEffect(()=>{const b=S=>{r(),o&&f.regress(),g&&g(S)},x=S=>{h&&h(S)},R=S=>{c&&c(S)};return C.addEventListener("change",b),C.addEventListener("start",x),C.addEventListener("end",R),()=>{C.removeEventListener("start",x),C.removeEventListener("end",R),C.removeEventListener("change",b)}},[g,h,c,C,r,y]),P.useEffect(()=>{if(e){const b=s().controls;return d({controls:C}),()=>d({controls:b})}},[e,C]),P.createElement("primitive",Ct({ref:n,object:C,enableDamping:l},v))});function un({all:e,scene:t,camera:o}){const i=D(({gl:g})=>g),l=D(({camera:g})=>g),u=D(({scene:g})=>g);return P.useLayoutEffect(()=>{const g=[];e&&(t||u).traverse(v=>{v.visible===!1&&(g.push(v),v.visible=!0)}),i.compile(t||u,o||l);const h=new vt(128);new mt(.01,1e5,h).update(i,t||u),h.dispose(),g.forEach(v=>v.visible=!1)},[]),null}export{ln as C,fn as O,un as P,Ee as u};
